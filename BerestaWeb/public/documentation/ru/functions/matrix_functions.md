# Матрицы

BerestaLanguage предоставляет минималистичную систему **2D-матричных трансформаций**, аналогичную той, что используется в GameMaker или низкоуровневых графических API.  
Эти функции позволяют создавать, изменять и применять аффинные матрицы преобразований к 2D-точкам.

Внутренне каждая матрица представляется структурой 2×3 (`Matrix2D`), хранящейся как:
```beresta
[a, b, c,
 d, e, f]
```
что соответствует матрице преобразования:
```beresta
| a b c |
| d e f |
| 0 0 1 |
```

Все функции работы с матрицами используют одну **глобально активную матрицу**.  
Эта матрица изменяется и повторно используется между вызовами функций, пока не будет сброшена или заменена.

Пример:
```beresta
matrix_identity();
matrix_build(1, 1, 45, 0, 0); // заменяет текущую матрицу
matrix_inverse();             // изменяет ту же текущую матрицу
```

---

## Список функций

| Функция | Описание |
| --- | --- |
| `matrix_get()` | Возвращает текущую матрицу трансформации как массив из 6 чисел. |
| `matrix_set(a, b, c, d, e, f)` | Заменяет текущие значения матрицы. |
| `matrix_build(scale_x, scale_y, rotation, translate_x, translate_y)` | Создаёт новую матрицу трансформации и делает её активной. |
| `matrix_identity()` | Сбрасывает текущую матрицу до единичной. |
| `matrix_multiply(a, b, c, d, e, f)` | Умножает текущую матрицу на другую и обновляет результат. |
| `matrix_inverse()` | Инвертирует текущую матрицу (если возможно). |
| `matrix_transform_vertex(x, y)` | Применяет текущую матрицу к 2D-точке `(x, y)` и возвращает результат. |

---

## Описание

`matrix_get()` Возвращает текущую матрицу как массив из шести чисел с плавающей точкой:
```beresta
let m = matrix_get();
console_print(m); // [1, 0, 0, 0, 1, 0] по умолчанию
```

`matrix_set(a, b, c, d, e, f)` Ручная установка значений текущей матрицы:
```beresta
matrix_set(1, 0, 32, 0, 1, 16);
console_print(matrix_get()); // [1, 0, 32, 0, 1, 16]
```

`matrix_build(scale_x, scale_y, rotation, translate_x, translate_y)` Создаёт и устанавливает новую матрицу на основе масштабирования, вращения и смещения. Полностью заменяет текущую матрицу:
```beresta
matrix_build(2, 2, 45, 100, 50);
console_print(matrix_get()); // возвращает [a, b, c, d, e, f] построенной матрицы
```

`matrix_identity()` Сбрасывает матрицу до единичного состояния:
```beresta
matrix_identity();
```

`matrix_multiply(a, b, c, d, e, f)` Умножает текущую матрицу на другую, заданную шестью числами:
```beresta
// Составление нескольких преобразований
matrix_identity();
matrix_multiply(1, 0, 10, 0, 1, 20);
```

`matrix_inverse()` Вычисляет и заменяет текущую матрицу её обратной.  
Если матрица не имеет обратной (детерминант = 0), функция выдаёт ошибку:
```beresta
matrix_inverse();
```

`matrix_transform_vertex(x, y)` Применяет текущую матрицу преобразования к 2D-точке `(x, y)` и возвращает массив `[tx, ty]` с преобразованными координатами:
```beresta
matrix_build(1, 1, 45, 10, 5);
let p = matrix_transform_vertex(10, 0);
console_print(p); // [преобразованный_x, преобразованный_y]
```

---

## Пример
```beresta
matrix_identity();                         // сброс
matrix_build(2, 2, 30, 10, 15);            // масштаб ×2, поворот 30°, сдвиг (10,15)

let pos = matrix_transform_vertex(1, 0);   // применить трансформацию
console_print(pos);

matrix_inverse();                          // инвертировать матрицу
console_print(matrix_get());               // вывести обратную матрицу

matrix_set(1, 0, 0, 0, 1, 0);              // ручной сброс
```

---

## Примечания

- Порядок преобразований: масштаб → поворот → сдвиг.  
- Система работает полностью в 2D.  
- Все трансформации изменяют текущую глобальную матрицу.  
- Матрицы всегда имеют размер 2×3 (аффинные), без перспективных или 3D-компонентов.  
- Все результаты возвращаются как числовые массивы `([a, b, c, d, e, f])` или векторы `[x, y]`.  
- Система матриц подходит для игровой логики, трансформации камеры или позиционирования 2D-объектов.
